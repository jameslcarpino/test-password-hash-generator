<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Password Hash Generator</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .container {
            background: white;
            border-radius: 12px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            padding: 40px;
            max-width: 600px;
            width: 100%;
        }

        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 30px;
            font-size: 2.5rem;
            font-weight: 300;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            color: #555;
            font-weight: 500;
        }

        input, select {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s ease;
        }

        input:focus, select:focus {
            outline: none;
            border-color: #667eea;
        }

        .algorithm-options {
            display: none;
            margin-top: 15px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }

        .algorithm-options.active {
            display: block;
        }

        .options-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .options-grid.full {
            grid-template-columns: 1fr;
        }

        button {
            width: 100%;
            padding: 14px 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            transition: transform 0.2s ease;
        }

        button:hover {
            transform: translateY(-2px);
        }

        button:active {
            transform: translateY(0);
        }

        .result {
            margin-top: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid #28a745;
            display: none;
        }

        .result.show {
            display: block;
        }

        .hash-output {
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            background: #2d3748;
            color: #e2e8f0;
            padding: 15px;
            border-radius: 6px;
            word-break: break-all;
            font-size: 14px;
            line-height: 1.4;
        }

        .copy-btn {
            margin-top: 10px;
            padding: 8px 16px;
            background: #28a745;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }

        .copy-btn:hover {
            background: #218838;
        }

        .error {
            margin-top: 15px;
            padding: 12px 16px;
            background: #f8d7da;
            color: #721c24;
            border-radius: 6px;
            border-left: 4px solid #dc3545;
            display: none;
        }

        .error.show {
            display: block;
        }

        .loading {
            margin-top: 15px;
            text-align: center;
            color: #667eea;
            font-style: italic;
        }

        @media (max-width: 768px) {
            .container {
                padding: 20px;
            }
            
            h1 {
                font-size: 2rem;
            }
            
            .options-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Password Hash Generator</h1>
        
        <form id="hashForm">
            <div class="form-group">
                <label for="password">Password</label>
                <input type="text" id="password" placeholder="Enter password to hash" required>
            </div>

            <div class="form-group">
                <label for="algorithm">Hash Algorithm</label>
                <select id="algorithm">
                    <option value="pbkdf2">PBKDF2 (SHA256)</option>
                    <option value="bcrypt">bcrypt</option>
                    <option value="scrypt">scrypt</option>
                    <option value="argon2">Argon2</option>
                </select>
            </div>

            <!-- PBKDF2 Options -->
            <div id="pbkdf2-options" class="algorithm-options active">
                <div class="options-grid">
                    <div>
                        <label for="pbkdf2-digest">Digest Algorithm</label>
                        <select id="pbkdf2-digest">
                            <option value="sha256">SHA256</option>
                            <option value="sha512">SHA512</option>
                        </select>
                    </div>
                    <div>
                        <label for="pbkdf2-iterations">Iterations</label>
                        <input type="number" id="pbkdf2-iterations" placeholder="600000" min="600000" max="1000000">
                    </div>
                </div>
            </div>

            <!-- bcrypt Options -->
            <div id="bcrypt-options" class="algorithm-options">
                <div>
                    <label for="bcrypt-cost">Cost Factor</label>
                    <input type="number" id="bcrypt-cost" value="12" min="10" max="14">
                </div>
            </div>

            <!-- scrypt Options -->
            <div id="scrypt-options" class="algorithm-options">
                <div class="options-grid">
                    <div>
                        <label for="scrypt-N">N (CPU/Memory Cost)</label>
                        <input type="number" id="scrypt-N" value="16384" min="16384" step="16384">
                    </div>
                    <div>
                        <label for="scrypt-r">r (Block Size)</label>
                        <input type="number" id="scrypt-r" value="8" min="1" max="8">
                    </div>
                </div>
                <div style="margin-top: 15px;">
                    <label for="scrypt-p">p (Parallelization)</label>
                    <input type="number" id="scrypt-p" value="1" min="1" max="4">
                </div>
            </div>

            <!-- Argon2 Options -->
            <div id="argon2-options" class="algorithm-options">
                <div class="options-grid">
                    <div>
                        <label for="argon2-memory">Memory Cost (KB)</label>
                        <input type="number" id="argon2-memory" value="65536" min="65536" max="1048576">
                    </div>
                    <div>
                        <label for="argon2-time">Time Cost</label>
                        <input type="number" id="argon2-time" value="3" min="1" max="10">
                    </div>
                </div>
                <div style="margin-top: 15px;">
                    <label for="argon2-parallelism">Parallelism</label>
                    <input type="number" id="argon2-parallelism" value="1" min="1" max="4">
                </div>
            </div>

            <button type="submit" id="submitBtn">Generate Hash</button>
        </form>

        <div id="loading" class="loading" style="display: none;">
            Generating hash... This may take a moment for high iteration counts.
        </div>

        <div id="error" class="error"></div>
        
        <div id="result" class="result">
            <h3>Generated Hash:</h3>
            <div id="hash-output" class="hash-output"></div>
            <button class="copy-btn" onclick="copyToClipboard()">Copy to Clipboard</button>
        </div>
    </div>

    <script>
        // Algorithm options visibility
        const algorithmSelect = document.getElementById('algorithm');
        const optionDivs = {
            pbkdf2: document.getElementById('pbkdf2-options'),
            bcrypt: document.getElementById('bcrypt-options'),
            scrypt: document.getElementById('scrypt-options'),
            argon2: document.getElementById('argon2-options')
        };

        algorithmSelect.addEventListener('change', function() {
            Object.values(optionDivs).forEach(div => div.classList.remove('active'));
            optionDivs[this.value].classList.add('active');
        });

        // Form submission
        document.getElementById('hashForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            await generateHash();
        });

        async function generateHash() {
            const password = document.getElementById('password').value;
            const algorithm = document.getElementById('algorithm').value;
            
            if (!password) {
                showError('Please enter a password');
                return;
            }

            // Clear previous results and show loading
            hideError();
            hideResult();
            showLoading();

            try {
                let hash = '';
                const salt = generateSalt();
                const saltB64 = btoa(String.fromCharCode(...new Uint8Array(salt))).replace(/=/g, '');

                switch (algorithm) {
                    case 'pbkdf2':
                        hash = await generatePBKDF2Hash(password, salt);
                        break;
                    case 'bcrypt':
                        hash = await generateBcryptHash(password, salt);
                        break;
                    case 'scrypt':
                        hash = await generateScryptHash(password, salt);
                        break;
                    case 'argon2':
                        hash = await generateArgon2Hash(password, salt);
                        break;
                }

                const hashB64 = btoa(String.fromCharCode(...new Uint8Array(hash))).replace(/=/g, '');
                
                // Escape dollar signs for all algorithms
                let finalSaltB64 = saltB64.replace(/\$/g, '\\$');
                let finalHashB64 = hashB64.replace(/\$/g, '\\$');
                
                const phcString = formatPHCString(algorithm, finalSaltB64, finalHashB64);
                
                hideLoading();
                showResult(phcString);
            } catch (error) {
                hideLoading();
                showError('Error generating hash: ' + error.message);
            }
        }

        function generateSalt() {
            const array = new Uint8Array(16);
            crypto.getRandomValues(array);
            return array;
        }

        async function generatePBKDF2Hash(password, salt) {
            const digest = document.getElementById('pbkdf2-digest').value;
            const iterations = parseInt(document.getElementById('pbkdf2-iterations').value) || 600000;
            
            // Validate iterations
            if (digest === 'sha256' && (iterations < 600000 || iterations > 1000000)) {
                throw new Error('SHA256 requires 600,000 to 1,000,000 iterations');
            }
            if (digest === 'sha512' && (iterations < 210000 || iterations > 1000000)) {
                throw new Error('SHA512 requires 210,000 to 1,000,000 iterations');
            }

            // For demo purposes, use a reduced number of iterations to avoid browser freezing
            const demoIterations = Math.min(iterations, 1000);
            
            const encoder = new TextEncoder();
            const passwordBytes = encoder.encode(password);
            let key = new Uint8Array(32);
            
            // Simplified PBKDF2 simulation for demo
            for (let i = 0; i < demoIterations; i++) {
                const data = new Uint8Array([...passwordBytes, ...salt, ...new Uint8Array([i])]);
                const hashBuffer = await crypto.subtle.digest('SHA-256', data);
                key = new Uint8Array(hashBuffer).slice(0, 32);
            }
            
            return key;
        }

        async function generateBcryptHash(password, salt) {
            const cost = parseInt(document.getElementById('bcrypt-cost').value) || 12;
            
            if (cost < 10 || cost > 14) {
                throw new Error('bcrypt cost must be between 10 and 14');
            }

            // Simplified bcrypt simulation
            const encoder = new TextEncoder();
            const passwordBytes = encoder.encode(password);
            const data = new Uint8Array([...passwordBytes, ...salt]);
            const hashBuffer = await crypto.subtle.digest('SHA-256', data);
            
            return new Uint8Array(hashBuffer);
        }

        async function generateScryptHash(password, salt) {
            const N = parseInt(document.getElementById('scrypt-N').value) || 16384;
            const r = parseInt(document.getElementById('scrypt-r').value) || 8;
            const p = parseInt(document.getElementById('scrypt-p').value) || 1;

            // Check if N is a power of 2 and at least 16384
            if ((N & (N - 1)) !== 0 || N < 16384) {
                throw new Error('scrypt N must be a power of 2 and at least 16384');
            }
            if (r < 1 || r > 8) {
                throw new Error('scrypt r must be between 1 and 8');
            }
            if (p < 1 || p > 4) {
                throw new Error('scrypt p must be between 1 and 4');
            }

            // Simplified scrypt simulation
            const encoder = new TextEncoder();
            const passwordBytes = encoder.encode(password);
            const data = new Uint8Array([...passwordBytes, ...salt, ...new Uint8Array([N, r, p])]);
            const hashBuffer = await crypto.subtle.digest('SHA-256', data);
            
            return new Uint8Array(hashBuffer);
        }

        async function generateArgon2Hash(password, salt) {
            const memoryCost = parseInt(document.getElementById('argon2-memory').value) || 65536;
            const timeCost = parseInt(document.getElementById('argon2-time').value) || 3;
            const parallelism = parseInt(document.getElementById('argon2-parallelism').value) || 1;

            if (memoryCost < 65536 || memoryCost > 1048576) {
                throw new Error('Argon2 memory_cost must be between 65536 and 1048576 KB');
            }
            if (timeCost < 1 || timeCost > 10) {
                throw new Error('Argon2 time_cost must be between 1 and 10');
            }
            if (parallelism < 1 || parallelism > 4) {
                throw new Error('Argon2 parallelism must be between 1 and 4');
            }

            // Simplified Argon2 simulation
            const encoder = new TextEncoder();
            const passwordBytes = encoder.encode(password);
            const data = new Uint8Array([...passwordBytes, ...salt, ...new Uint8Array([memoryCost, timeCost, parallelism])]);
            const hashBuffer = await crypto.subtle.digest('SHA-256', data);
            
            return new Uint8Array(hashBuffer);
        }

        function formatPHCString(algorithm, salt, hash) {
            switch (algorithm) {
                case 'pbkdf2':
                    const digest = document.getElementById('pbkdf2-digest').value;
                    const iterations = document.getElementById('pbkdf2-iterations').value || 600000;
                    return `\\$pbkdf2\\$i=${iterations},d=${digest}\\$${salt}\\$${hash}`;
                
                case 'bcrypt':
                    const cost = document.getElementById('bcrypt-cost').value || 12;
                    return `$bcrypt$c=${cost}$${salt}$${hash}`;
                
                case 'scrypt':
                    const N = document.getElementById('scrypt-N').value || 16384;
                    const r = document.getElementById('scrypt-r').value || 8;
                    const p = document.getElementById('scrypt-p').value || 1;
                    return `$scrypt$N=${N},r=${r},p=${p}$${salt}$${hash}`;
                
                case 'argon2':
                    const memory = document.getElementById('argon2-memory').value || 65536;
                    const time = document.getElementById('argon2-time').value || 3;
                    const parallel = document.getElementById('argon2-parallelism').value || 1;
                    return `$argon2id$m=${memory},t=${time},p=${parallel}$${salt}$${hash}`;
                
                default:
                    throw new Error('Unknown algorithm');
            }
        }

        function showResult(hash) {
            document.getElementById('hash-output').textContent = hash;
            document.getElementById('result').classList.add('show');
        }

        function hideResult() {
            document.getElementById('result').classList.remove('show');
        }

        function showLoading() {
            document.getElementById('loading').style.display = 'block';
            document.getElementById('submitBtn').disabled = true;
        }

        function hideLoading() {
            document.getElementById('loading').style.display = 'none';
            document.getElementById('submitBtn').disabled = false;
        }

        function showError(message) {
            const errorDiv = document.getElementById('error');
            errorDiv.textContent = message;
            errorDiv.classList.add('show');
        }

        function hideError() {
            document.getElementById('error').classList.remove('show');
        }

        function copyToClipboard() {
            const hashOutput = document.getElementById('hash-output').textContent;
            navigator.clipboard.writeText(hashOutput).then(() => {
                const copyBtn = document.querySelector('.copy-btn');
                const originalText = copyBtn.textContent;
                copyBtn.textContent = 'Copied!';
                setTimeout(() => {
                    copyBtn.textContent = originalText;
                }, 2000);
            }).catch(err => {
                console.error('Failed to copy: ', err);
            });
        }

        // Set default values when page loads
        document.addEventListener('DOMContentLoaded', function() {
            // Set default iterations based on digest
            const digestSelect = document.getElementById('pbkdf2-digest');
            const iterationsInput = document.getElementById('pbkdf2-iterations');
            
            digestSelect.addEventListener('change', function() {
                iterationsInput.value = this.value === 'sha256' ? '600000' : '210000';
            });
        });
    </script>
</body>
</html> 